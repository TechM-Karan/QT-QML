import QtQuick 2.0

Item {
    anchors.fill: parent
    property int activeTabIndex: 0

    ListModel {
        id:localImgs
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}
        ListElement{img: "qrc:/images/images/1.jpg"}
        ListElement{img: "qrc:/images/images/2.jpg"}
        ListElement{img: "qrc:/images/images/3.jpg"}
        ListElement{img: "qrc:/images/images/4.jpg"}
        ListElement{img: "qrc:/images/images/5.jpg"}
        ListElement{img: "qrc:/images/images/6.jpg"}
        ListElement{img: "qrc:/images/images/7.jpg"}
        ListElement{img: "qrc:/images/images/8.jpg"}
        ListElement{img: "qrc:/images/images/9.jpg"}
        ListElement{img: "qrc:/images/images/10.jpg"}
        ListElement{img: "qrc:/images/images/11.jpg"}

    }

    Column{
        anchors.fill: parent

        Rectangle{
            id:header
            width: parent.width
            height: parent.height*.1
            color: "#00796b"
            Text{
                anchors.centerIn: parent
                text: "Image Gallery"
                font.pointSize: 24
                font.bold: true
                color: "white"
            }
        }

        Rectangle{
            width: parent.width
            height: parent.height*.08
            color: "#f2f2f2"
            Row{
                anchors.fill: parent
                Rectangle{
                    id:tab1Container
                    width: parent.width/2
                    height: parent.height
                    color: activeTabIndex == 0 ? "#48a999" : "#f2f2f2"
                    Text{
                        anchors.centerIn: parent
                        text:"Local Photos"
                        font.pointSize: 20
                        color: activeTabIndex == 0 ? "white": "black"
                    }
                    MouseArea{
                        anchors.fill: parent
                        onClicked: {
                            activeTabIndex = 0;
                            griditem.model = localImgs
                        }
                    }
                }

                Rectangle{
                    id:tab2Container
                    width: parent.width/2
                    height: parent.height
                    color: activeTabIndex == 1 ? "#48a999" : "#f2f2f2"
                    Text{
                        anchors.centerIn: parent
                        text:"Cloud Photos"
                        font.pointSize: 20
                        color: activeTabIndex == 1 ? "white": "black"
                    }
                    MouseArea{
                        anchors.fill: parent
                        onClicked: {
                            activeTabIndex = 1;
                            griditem.model = 3000
                        }
                    }
                }
            }
        }

        Item{
            width: parent.width
            height: parent.height*.82
            GridView {
                id:griditem
                anchors.fill: parent
                cellWidth: griditem.width/2
                cellHeight: griditem.width/2
                model: localImgs
                clip: true

                delegate: Item {
                    id: container
                    width: griditem.cellWidth
                    height: griditem.cellHeight

                    property Item item

                    Connections {
                        target: item
                        ignoreUnknownSignals: true

                        onButtonClicked: {
                            console.log("HELLO WORLD")
                        }
                    }

                    Component.onCompleted:
                    {
                        item = elementCache.getDelegate()
                        item.parent = container
                        item.anchors.fill = Qt.binding(function (){ return container })
                        //                item.indexNo = index;
                        item.indexNo = Qt.binding(function (){
                            return index;
                        })
                        item.localimg = img
                        //item.aStaticProperty = model.constantBoolRole
                    }

                    Component.onDestruction:
                    {
                        elementCache.returnDelegate(item)
                    }
                }
            }
            Item {
                id: elementCache

                visible: false

                property var delegateCache: []

                function getDelegate() {
                    console.log("getDelegate, cache size", delegateCache.length)
                    if (delegateCache.length > 0)
                    {
                        return delegateCache.pop()
                    }
                    else
                    {
                        return delegateComponent.createObject(elementCache)
                    }
                }

                function returnDelegate( item ) {
                    console.log("returnDelegate", item, "size", delegateCache.length)

                    item.parent = elementCache

                    /*
                    reset all properties of the delegate
                    this is important to get rid of bindings
                    if you dont do this, you may experience crashes

                    i.e.

                    item.myProperty = ""
                    item.myBindedProperty = false
                */
                    item.anchors.fill = elementCache
                    item.localimg = ""
                    item.aStaticProperty = false

                    delegateCache.push( item )
                }

                Component.onCompleted: {
                    for (var i = 0; i < 10; ++i)
                    {
                        var element = delegateComponent.createObject(elementCache)
                        delegateCache.push(element)
                    }
                }

                Component {
                    id: delegateComponent

                    Item{
                        width: griditem.cellWidth
                        height: griditem.cellHeight
                        property int indexNo: 0
                        property var localimg
                        property bool aStaticProperty: false
                        Rectangle{
                            anchors.fill: parent
                            anchors.margins: 10
                            anchors.centerIn: parent
                            border.color: "gray"
                            border.width: 2
                            radius: 4
                            Image {
                                anchors.fill: parent
                                anchors.margins: 2
                                anchors.centerIn: parent
                                source: activeTabIndex == 0 ? localimg : "https://picsum.photos/id/"+indexNo+"/200/300"
                            }
                        }


                    }
                }
            }
        }
    }
}
